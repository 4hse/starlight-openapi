---
import type { Operation } from '../../libs/operation'
import type { Schema } from '../../libs/schema'
import { getSecurityRequirements } from '../../libs/security'
import { interspece } from '../../libs/utils'
import Section from '../Section.astro'

interface Props {
  operation: Operation
  schema: Schema
}

const { operation, schema } = Astro.props

const requirements = getSecurityRequirements(schema, operation)
---

{
  requirements && requirements.length > 0 ? (
    <Section level={2} title="Authorizations">
      <ul>
        {requirements.map((requirement) => {
          const schemes = Object.keys(requirement)

          if (schemes.length === 0) {
            return (
              <li>
                <strong>None</strong>
              </li>
            )
          }

          return Object.entries(requirement).map(([scheme, scopes]) => {
            return (
              <li>
                <strong>{scheme}</strong>
                {scopes.length > 0 ? (
                  <>
                    <!-- prettier-ignore-start -->
                    ({interspece(
                      ' - ',
                      scopes.map((scope) => <code>{scope}</code>),
                    )})
                    <!-- prettier-ignore-end -->
                  </>
                ) : null}
              </li>
            )
          })
        })}
      </ul>
    </Section>
  ) : null
}
